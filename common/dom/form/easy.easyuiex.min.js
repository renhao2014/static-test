/**
 * EasyUIEx
 *
 * Version 2.2.8
 *
 * http://easyproject.cn https://github.com/ushelp
 *
 * Copyright 2014 Ray [ inthinkcolor@gmail.com ]
 *
 * Dependencies: jQuery EasyUI
 *
 */
(function(){var _uiEx=window.uiEx;var uiEx={showRowEditMsg:false,showRowAddMsg:false,showRowDeleteMsg:true,msgDefaults:{timeout:4000,showType:'slide'},dataGridDefaults:{rownumbers:true,fitColumns:true,singleSelect:true,pagination:true,method:"post",striped:true },detailDataGridDefaults:{rownumbers:true,fitColumns:true,singleSelect:true,pagination:true,method:"post",striped:true,detailFormatter:function(index,row){return '<div class="ddv"></div>'}},expReg:/\{([\s\S]+?)\}/g,msg:{}};uiEx.globalDialogMap={};uiEx.globalContextMenuMap={};var dgLastEditIndex={},dgLastEditType={},dgLastEditData={},dgLastCellField={},dgType={},dgHeaderMenu={},treeChkData={};var toEdit=function toEdit(dgId,dg,rowIndex,rowData){if(endEditing(dg)){dg.datagrid('selectRow',rowIndex).datagrid("beginEdit",rowIndex);dgLastEditIndex[dgId]=rowIndex;dgLastEditType[dgId]="edit";var rowDataClone={};$.extend(true,rowDataClone,rowData);dgLastEditData[dgId]=rowDataClone}else{dg.datagrid("selectRow",rowIndex)}},endEditing=function(datagridSelector,showMsg){var dg=$(datagridSelector);var dgId=dg.attr("id");var lastEditIndex=dgLastEditIndex[dgId];if(lastEditIndex==undefined){return true}var type=dgLastEditType[dgId];if(dg.datagrid('validateRow',lastEditIndex)){dg.datagrid("endEdit",lastEditIndex);if(jsonEquals(dg.datagrid('getRows')[lastEditIndex],dgLastEditData[dgId])){uiEx.rowCancelEdit(datagridSelector);clearLast(dgId);return true}if(type=="editcell"){var field=dgLastCellField[dgId];if(jsonEquals(dg.datagrid('getRows',lastEditIndex)[lastEditIndex][field],dgLastEditData[dgId])){uiEx.rowCancelEdit(datagridSelector);clearLast(dgId);return true}}var url=dg.datagrid("options").updateUrl;var success=uiEx.rowEditSuccessMsg;var failure=uiEx.rowEditFailureMsg;var method=dg.datagrid("options").method;if(type=="add"){if(showMsg==undefined){showMsg=uiEx.showRowAddMsg}url=dg.datagrid("options").saveUrl;success=uiEx.rowAddSuccessMsg;failure=uiEx.rowAddFailureMsg}else if(type=="edit"){if(showMsg==undefined){showMsg=uiEx.showRowEditMsg}}var opts=dg.datagrid("options");var row=dg.datagrid('getRows')[lastEditIndex];var row2={};if(opts.sendRowDataPrefix){$.each(row,function(i,v){row2[opts.sendRowDataPrefix+i]=row[i]})}else{row2=row}if(dg.datagrid("options")){if(dg.datagrid("options").pageSize){row2.rows=dg.datagrid("options").pageSize}if(dg.datagrid("options").pageNumber){row2.page=dg.datagrid("options").pageNumber}}$.ajax({url:url,type:method,data:row2,error:function(){if(showMsg){uiEx.msg(failure)}},success:function(data){if(showMsg){uiEx.msg(success)}dg.datagrid('updateRow',{index:lastEditIndex,row:data.rowData})}});clearLast(dgId);return true}else{return false}},createColumnMenu=function(datagridSelector){var cmenu=$("<div/>").appendTo("body");cmenu.menu({onClick:function(item){if(item.iconCls=="icon-ok"){$(datagridSelector).datagrid("hideColumn",item.name);cmenu.menu("setIcon",{target:item.target,iconCls:'icon-empty'})}else{$(datagridSelector).datagrid("showColumn",item.name);cmenu.menu("setIcon",{target:item.target,iconCls:"icon-ok"})}}});var fields=$(datagridSelector).datagrid("getColumnFields");for(var i=0;i<fields.length;i+=1){var field=fields[i];var col=$(datagridSelector).datagrid("getColumnOption",field);cmenu.menu("appendItem",{text:col.title,name:field,iconCls:'icon-ok'})}return cmenu},clearLast=function(dgId){dgLastEditIndex[dgId]=undefined;dgLastEditData[dgId]=undefined;dgLastEditType[dgId]=undefined;dgLastCellField[dgId]=undefined},jsonEquals=function(data,data2){var obj=false;var obj2=false;if((typeof data!="string")&&(typeof data!="number")&&(typeof data!="boolean")){for(var i in data){obj=true;break}for(var i in data2){obj2=true;break}}if(obj&&obj2){for(var i in data){if(!jsonEquals(data[i],data2[i])){return false}}return true}else{return(data+"")==(data2+"")}},showDatagridContextMenu=function(e,index,row){e.preventDefault();if(index!=-1){$(this).datagrid('selectRow',index);$($(this).datagrid('options').menuSelector).menu('show',{left:e.pageX,top:e.pageY})}},showTreegridContextMenu=function(e,index,row){e.preventDefault();if(index!=-1){$(this).treegrid('select',row.id);$($(this).treegrid('options').menuSelector).menu('show',{left:e.pageX,top:e.pageY})}},showHeaderMenu=function(e,field){e.preventDefault();var datagridSelector=this;var dgId=$(this).attr("id");var cmenu=dgHeaderMenu[dgId];if(cmenu==undefined){cmenu=createColumnMenu(datagridSelector);dgHeaderMenu[dgId]=cmenu}cmenu.menu("show",{left:e.pageX,top:e.pageY})},clickRowEdit=function(rowIndex,rowData){var dg=$(this);var dgId=dg.attr("id");var lastEditIndex=dgLastEditIndex[dgId];if(lastEditIndex!=rowIndex){toEdit(dgId,dg,rowIndex,rowData)}},clickCellEdit=function(rowIndex,field,value){var dg=$(this);var dgId=dg.attr("id");if(endEditing(dg)){dg.datagrid('selectRow',rowIndex).datagrid('editCell',{index:rowIndex,field:field});dgLastEditIndex[dgId]=rowIndex;dgLastEditType[dgId]="editcell";dgLastEditData[dgId]=value;dgLastCellField[dgId]=field}},initDgContextMenu=function(params,p){if(params.showContextMenu){if(params.onRowContextMenu){var userEvent=params.onRowContextMenu;p.onRowContextMenu=function(e,index,row){userEvent(e,index,row);showDatagridContextMenu(e,index,row)}}else{p.onRowContextMenu=showDatagridContextMenu}}},initTgContextMenu=function(params,p){if(params.showContextMenu){if(params.onContextMenu){var userEvent=params.onContextMenu;p.onContextMenu=function(e,index,row){userEvent(e,index,row);showTreegridContextMenu(e,index,row)}}else{p.onContextMenu=showTreegridContextMenu}}},initDgHeaderContextMenu=function(params,p){if(params.showHeaderContextMenu){if(params.onHeaderContextMenu){var userEvent=params.onHeaderContextMenu;p.onHeaderContextMenu=function(e,field){userEvent(e,field);showHeaderMenu(e,field)}}else{p.onHeaderContextMenu=showHeaderMenu}}},destoryTab=function(title){$('.window-shadow:gt(0)').remove();if(uiEx.globalDialogMap[title]){var globalDialogs="#"+uiEx.globalDialogMap[title].join("#")+"#";$(".easyui-dialog").each(function(){if(globalDialogs.indexOf("#"+this.id+"#")==-1){var dialogTemp=$('#'+this.id);dialogTemp.dialog({closed:true});dialogTemp.dialog('destroy',true)}});uiEx.globalDialogMap[title]=[]}if(uiEx.globalContextMenuMap[title]){var globalContextMenuss="#"+uiEx.globalContextMenuMap[title].join("#")+"#";$(".easyui-menu").not("#tabsMenu").each(function(){if(globalContextMenuss.indexOf("#"+this.id+"#")==-1){var contextMenuTemp=$('#'+this.id);contextMenuTemp.menu('destroy')}});uiEx.globalContextMenuMap[title]=[]}};$.extend($.fn.datagrid.methods,{editCell:function(jq,param){return jq.each(function(){var fields=$(this).datagrid('getColumnFields',true).concat($(this).datagrid('getColumnFields'));for(var i=0;i<fields.length;i+=1){var col=$(this).datagrid('getColumnOption',fields[i]);col.editor1=col.editor;if(fields[i]!=param.field){col.editor=null}}$(this).datagrid('beginEdit',param.index);for(var i=0;i<fields.length;i+=1){var col=$(this).datagrid('getColumnOption',fields[i]);col.editor=col.editor1}})}});uiEx.alert=function(msg,icon,callback){$.messager.alert(this.alertTitle,msg,icon,callback)};uiEx.confirm=function(msg,callback){$.messager.confirm(this.confirmTitle,msg,callback)};uiEx.prompt=function(msg,callback){$.messager.prompt(this.promptTitle,msg,callback)};uiEx.msg=function(msg,position,params){var style;if(position){position=position.toLowerCase();if(position=="topleft"){style={right:'',left:0,top:document.body.scrollTop+document.documentElement.scrollTop,bottom:''}}else if(position=="topcenter"){style={right:'',top:document.body.scrollTop+document.documentElement.scrollTop,bottom:''}}else if(position=="topright"){style={left:'',right:0,top:document.body.scrollTop+document.documentElement.scrollTop,bottom:''}}else if(position=="centerleft"){style={left:0,right:'',bottom:''}}else if(position=="center"){style={right:'',bottom:''}}else if(position=="centerright"){style={left:'',right:0,bottom:''}}else if(position=="bottomleft"){style={left:0,right:'',top:'',bottom: -document.body.scrollTop-document.documentElement.scrollTop}}else if(position=="bottomcenter"){style={right:'',top:'',bottom: -document.body.scrollTop-document.documentElement.scrollTop}}}var p={};if(!params){params={}}params.style=style;params.msg=msg;params.title=this.msgTitle,$.extend(p,uiEx.msgDefaults,params);$.messager.show(p)};uiEx.openDialog=function(dialogSelector,title){if(!title){title=$(dialogSelector).panel('options').title}return $(dialogSelector).dialog({cache:false,closed:false,title:title})};uiEx.openHrefDialog=function(dialogSelector,href,title){if(!title){title=$(dialogSelector).panel('options').title}return $(dialogSelector).dialog({href:href,cache:false,closed:false,title:title})};uiEx.closeDialog=function(dialogSelector){return $(dialogSelector).dialog({closed:true})};uiEx.clearForm=function(selector){return this.disableValidate(selector).form('clear')};uiEx.resetForm=function(selector){return this.disableValidate(selector).form('reset')};uiEx.loadForm=function(selector,data,prefix){if(!prefix){prefix=""}var data2={};$.each(data,function(i,v){data2[prefix+i]=v});$(selector).form("load",data2)};uiEx.enableValidate=function(selector){return $(selector).form('enableValidation')};uiEx.disableValidate=function(selector){return $(selector).form('disableValidation')};uiEx.validate=function(selector){return this.enableValidate(selector).form('validate')};uiEx.serializeJSON=function(formSelector){var o={};var a=$(formSelector).serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||'')}else{o[this.name]=this.value||''}});return o};uiEx.submitForm=function(formSelector,params,noValidate){var addDoms=[];if(params){$.each(params,function(name,value){var newDom=$('<input type="text" name="'+name+'" value="'+value+'"/>');$(formSelector).append(newDom);addDoms.push(newDom)})}if(noValidate==false){$(formSelector)[0].submit()}else{if(this.validate(formSelector)){$(formSelector)[0].submit()}}$.each(addDoms,function(i,dom){$(dom).remove()})};uiEx.submitAjax=function(formSelector,callback,params,noValidate){uiEx.submitURLAjax(formSelector,null,callback,params,noValidate)};uiEx.submitURLAjax=function(formSelector,url,callback,params,noValidate){var successCallback=function(data){if(callback){callback(data)}if(uiEx.formSubmitSuccess){uiEx.formSubmitSuccess(data)}};if(url){$(formSelector).form('submit',{url:url,onSubmit:function(param){if(!param){param={}}if(params){$.extend(param,params)}param.xRequestedWith="XMLHttpRequest";if(noValidate==false){return true}else{return uiEx.validate(formSelector)}},success:successCallback,error:function(){uiEx.msg(uiEx.ajaxError,"bottomRight")}})}else{$(formSelector).form('submit',{onSubmit:function(param){if(!param){param={}}if(params){$.extend(param,params)}param.xRequestedWith="XMLHttpRequest";if(noValidate==false){return true}else{return uiEx.validate(formSelector)}},success:successCallback,error:function(){uiEx.msg(uiEx.ajaxError,"bottomRight")}})}};uiEx.openTab=function(tabSelector,title,url,icon,isIframe){var tab=$(tabSelector);if(tab.tabs('exists',title)){destoryTab(title);uiEx.openTab(tabSelector,title,url,icon,isIframe);}else{tab.tabs({onBeforeClose:function(){destoryTab(title);return true}});var addParams={title:title,closable:true,selected:true,iconCls:icon,onBeforeLoad:function(){$(".easyui-dialog").each(function(){if(!uiEx.globalDialogMap[title]){uiEx.globalDialogMap[title]=[]}uiEx.globalDialogMap[title].push(this.id)});$(".easyui-menu").each(function(){if(!uiEx.globalContextMenuMap[title]){uiEx.globalContextMenuMap[title]=[]}uiEx.globalContextMenuMap[title].push(this.id)});return true}};if(isIframe){var content='<iframe scrolling="auto" frameborder="0" src="'+url+'" style="width:100%;height:100%;"></iframe>';addParams["content"]=content}else{addParams["href"]=url}tab.tabs('add',addParams);}$(".tabs-inner").on("dblclick",function(){var subtitle=$(this).children(".tabs-closable").text();$('#tabs').tabs('close',subtitle)})};uiEx.reloadSelTab=function(tabSelector){var tab=$(tabSelector).tabs("getSelected");destoryTab(tab.panel('options').title);tab.panel("refresh")};uiEx.openMenuByText=function(menuSelector,tabSelector,menuText){var menu=$(menuSelector);var menuOpen=function(txt){var node=menu.tree("getNode",$(".tree-node:contains('"+txt+"')")[0]);if(node){uiEx.openTab(tabSelector,node.text,node.url,node.iconCls);menu.tree('select',node.target)}};if($.isArray(menuText)){for(var i=0;i<menuText.length;i+=1){menuOpen(menuText[i])}}else{menuOpen(menuText)}};uiEx.openMenuById=function(menuSelector,tabSelector,menuId){var menu=$(menuSelector);var menuOpen=function(id){var node=menu.tree('find',id);if(node){uiEx.openTab(tabSelector,node.text,node.url,node.iconCls);menu.tree('select',node.target)}};if($.isArray(menuId)){for(var i=0;i<menuId.length;i+=1){menuOpen(menuId[i])}}else{menuOpen(menuId)}};var contextMenuTab;